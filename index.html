<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EasyInvoice - نظام فواتير احترافي</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-router-dom/6.26.2/react-router-dom.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chart.js/4.4.4/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://unpkg.com/i18next@23.15.1/dist/umd/i18next.min.js"></script>
  <script src="https://unpkg.com/react-i18next@14.1.3/dist/umd/react-i18next.min.js"></script>
  <script src="https://unpkg.com/react-hook-form@7.53.0/dist/react-hook-form.min.js"></script>
  <script src="https://unpkg.com/zod@3.23.8/lib/index.umd.js"></script>
  <script src="https://unpkg.com/aos@2.3.4/dist/aos.jsHannahs-MacBook-Pro.local/aos.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Poppins:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://unpkg.com/aos@2.3.4/dist/aos.css" rel="stylesheet">
</head>
<body class="bg-gray-100 dark:bg-gray-900 font-cairo transition-colors duration-300">
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;
    const { BrowserRouter, Routes, Route, Link, useNavigate } = ReactRouterDOM;
    const { useTranslation, initReactI18next } = ReactI18Next;
    const { useForm, Controller } = ReactHookForm;

    // Initialize i18next
    i18next.use(initReactI18next).init({
      resources: {
        ar: {
          translation: {
            "hero_title": "EasyInvoice — نظام فواتير احترافي جاهز للعرض",
            "hero_subtitle": "أنشئ، اطبع، وأرسل فواتيرك خلال دقائق — كلّها بدون سيرفر",
            "try_demo": "جرّب العرض المجاني",
            "features": "المميزات",
            "feature_1": "إنشاء فواتير بسهولة",
            "feature_2": "تصدير PDF وCSV",
            "feature_3": "تقارير وإحصائيات",
            "feature_4": "إدارة العملاء",
            "contact_us": "تواصل معنا",
            "name": "الاسم الكامل",
            "email": "البريد الإلكتروني",
            "message": "الرسالة",
            "send": "إرسال",
            "dashboard": "لوحة التحكم",
            "invoices": "الفواتير",
            "clients": "العملاء",
            "settings": "الإعدادات",
            "total_invoices": "إجمالي الفواتير",
            "total_paid": "إجمالي المدفوع",
            "overdue": "الفواتير المتأخرة",
            "total_clients": "عدد العملاء",
            "new_invoice": "إنشاء فاتورة جديدة",
            "export_csv": "تصدير CSV",
            "invoice_number": "رقم الفاتورة",
            "client_name": "اسم العميل",
            "due_date": "تاريخ الاستحقاق",
            "amount": "المبلغ",
            "status": "الحالة",
            "paid": "مدفوع",
            "unpaid": "غير مدفوع",
            "partially_paid": "مدفوع جزئيًا",
            "view": "عرض",
            "edit": "تعديل",
            "print": "طباعة",
            "send_email": "إرسال بالبريد",
            "create_invoice": "إنشاء فاتورة",
            "company_name": "اسم الشركة",
            "address": "العنوان",
            "phone": "الهاتف",
            "vat_number": "رقم ضريبي",
            "notes": "ملاحظات",
            "save": "حفظ",
            "dark_mode": "الوضع الداكن",
            "language": "اللغة",
            "currency": "العملة",
            "tax_rate": "نسبة الضريبة",
            "item_desc": "الوصف",
            "quantity": "الكمية",
            "unit_price": "سعر الوحدة",
            "subtotal": "المجموع الفرعي",
            "tax": "الضريبة",
            "discount": "الخصم",
            "total": "الإجمالي",
            "preview": "معاينة",
            "mark_paid": "تمييز كمدفوع",
            "success_message": "تم إرسال الرسالة بنجاح!",
            "footer_links": "روابط مفيدة",
            "privacy_policy": "سياسة الخصوصية",
            "terms": "الشروط والأحكام",
            "contact": "اتصل بنا",
          }
        },
        en: {
          translation: {
            "hero_title": "EasyInvoice — Professional Invoicing System",
            "hero_subtitle": "Create, print, and send invoices in minutes — all serverless.",
            "try_demo": "Try the Free Demo",
            "features": "Features",
            "feature_1": "Easy Invoice Creation",
            "feature_2": "Export PDF & CSV",
            "feature_3": "Reports & Analytics",
            "feature_4": "Client Management",
            "contact_us": "Contact Us",
            "name": "Full Name",
            "email": "Email",
            "message": "Message",
            "send": "Send",
            "dashboard": "Dashboard",
            "invoices": "Invoices",
            "clients": "Clients",
            "settings": "Settings",
            "total_invoices": "Total Invoices",
            "total_paid": "Total Paid",
            "overdue": "Overdue Invoices",
            "total_clients": "Total Clients",
            "new_invoice": "New Invoice",
            "export_csv": "Export CSV",
            "invoice_number": "Invoice Number",
            "client_name": "Client Name",
            "due_date": "Due Date",
            "amount": "Amount",
            "status": "Status",
            "paid": "Paid",
            "unpaid": "Unpaid",
            "partially_paid": "Partially Paid",
            "view": "View",
            "edit": "Edit",
            "print": "Print",
            "send_email": "Send Email",
            "create_invoice": "Create Invoice",
            "company_name": "Company Name",
            "address": "Address",
            "phone": "Phone",
            "vat_number": "VAT Number",
            "notes": "Notes",
            "save": "Save",
            "dark_mode": "Dark Mode",
            "language": "Language",
            "currency": "Currency",
            "tax_rate": "Tax Rate",
            "item_desc": "Description",
            "quantity": "Quantity",
            "unit_price": "Unit Price",
            "subtotal": "Subtotal",
            "tax": "Tax",
            "discount": "Discount",
            "total": "Total",
            "preview": "Preview",
            "mark_paid": "Mark as Paid",
            "success_message": "Message sent successfully!",
            "footer_links": "Useful Links",
            "privacy_policy": "Privacy Policy",
            "terms": "Terms & Conditions",
            "contact": "Contact Us",
          }
        }
      },
      lng: "ar",
      fallbackLng: "en",
      interpolation: { escapeValue: false }
    });

    // Mock data
    const mockInvoices = [
      {
        id: "INV-2025-001",
        issueDate: "2025-09-01",
        dueDate: "2025-09-15",
        client: {
          id: "C001",
          name: "شركة النخبة للتجارة",
          email: "info@alkhibah.example",
          address: "شارع التحرير، القاهرة"
        },
        items: [
          { desc: "تصميم موقع", qty: 1, unitPrice: 2500 },
          { desc: "استضافة سنوية", qty: 1, unitPrice: 300 }
        ],
        subtotal: 2800,
        taxPercent: 14,
        tax: 392,
        discount: 0,
        total: 3192,
        status: "Unpaid"
      }
    ];

    const mockClients = [
      {
        id: "C001",
        company: "شركة النخبة للتجارة",
        contact: "أحمد علي",
        email: "info@alkhibah.example",
        phone: "+20-10-1234-5678",
        vatNumber: "EG-123456789"
      }
    ];

    // Components
    const Header = () => {
      const { t, i18n } = useTranslation();
      const [darkMode, setDarkMode] = useState(false);

      useEffect(() => {
        if (darkMode) {
          document.documentElement.classList.add('dark');
        } else {
          document.documentElement.classList.remove('dark');
        }
      }, [darkMode]);

      return (
        <header className="bg-blue-600 dark:bg-gray-800 text-white p-4">
          <div className="container mx-auto flex justify-between items-center">
            <h1 className="text-xl font-bold">EasyInvoice</h1>
            <nav className="flex space-x-4 space-x-reverse">
              <Link to="/" className="hover:underline">{t('dashboard')}</Link>
              <Link to="/invoices" className="hover:underline">{t('invoices')}</Link>
              <Link to="/clients" className="hover:underline">{t('clients')}</Link>
              <Link to="/settings" className="hover:underline">{t('settings')}</Link>
              <button
                onClick={() => i18n.changeLanguage(i18n.language === 'ar' ? 'en' : 'ar')}
                className="hover:underline"
              >
                {t('language')}
              </button>
              <button
                onClick={() => setDarkMode(!darkMode)}
                className="hover:underline"
              >
                {t('dark_mode')}
              </button>
            </nav>
          </div>
        </header>
      );
    };

    const Footer = () => {
      const { t } = useTranslation();
      return (
        <footer className="bg-gray-800 dark:bg-gray-900 text-white py-6">
          <div className="container mx-auto text-center">
            <p>&copy; 2025 EasyInvoice. {t('footer_links')}</p>
            <div className="flex justify-center space-x-4 space-x-reverse mt-4">
              <Link to="/privacy" className="hover:underline">{t('privacy_policy')}</Link>
              <Link to="/terms" className="hover:underline">{t('terms')}</Link>
              <Link to="/contact" className="hover:underline">{t('contact')}</Link>
            </div>
          </div>
        </footer>
      );
    };

    const LandingPage = () => {
      const { t } = useTranslation();
      const { register, handleSubmit, reset } = useForm();
      const onSubmit = () => {
        alert(t('success_message'));
        reset();
      };

      return (
        <div className="min-h-screen">
          <div className="bg-blue-600 dark:bg-gray-800 text-white py-20 text-center" data-aos="fade-up">
            <h1 className="text-4xl font-bold mb-4">{t('hero_title')}</h1>
            <p className="text-lg mb-6">{t('hero_subtitle')}</p>
            <Link to="/dashboard" className="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg">
              {t('try_demo')}
            </Link>
          </div>
          <div className="container mx-auto py-12">
            <h2 className="text-2xl font-bold text-center mb-8">{t('features')}</h2>
            <div className="grid grid-cols-1 md:grid-cols-4 gap-6" data-aos="fade-up">
              <div className="bg-white dark:bg-gray-700 p-6 rounded-lg shadow">
                <p>{t('feature_1')}</p>
              </div>
              <div className="bg-white dark:bg-gray-700 p-6 rounded-lg shadow">
                <p>{t('feature_2')}</p>
              </div>
              <div className="bg-white dark:bg-gray-700 p-6 rounded-lg shadow">
                <p>{t('feature_3')}</p>
              </div>
              <div className="bg-white dark:bg-gray-700 p-6 rounded-lg shadow">
                <p>{t('feature_4')}</p>
              </div>
            </div>
            <h2 className="text-2xl font-bold text-center my-8">{t('contact_us')}</h2>
            <form onSubmit={handleSubmit(onSubmit)} className="max-w-lg mx-auto space-y-4" data-aos="fade-up">
              <input {...register('name')} placeholder={t('name')} className="w-full p-3 rounded-lg dark:bg-gray-700" required />
              <input {...register('email')} type="email" placeholder={t('email')} className="w-full p-3 rounded-lg dark:bg-gray-700" required />
              <textarea {...register('message')} placeholder={t('message')} className="w-full p-3 rounded-lg dark:bg-gray-700" rows="4" required></textarea>
              <button type="submit" className="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg">{t('send')}</button>
            </form>
          </div>
        </div>
      );
    };

    const Dashboard = () => {
      const { t } = useTranslation();
      useEffect(() => {
        const ctx = document.getElementById('revenueChart')?.getContext('2d');
        if (ctx) {
          new Chart(ctx, {
            type: 'line',
            data: {
              labels: ['يناير', 'فبراير', 'مارس'],
              datasets: [{
                label: 'الإيرادات',
                data: [12000, 19000, 15000],
                borderColor: '#0B5FFF',
                fill: false
              }]
            }
          });
        }
      }, []);

      return (
        <div className="container mx-auto py-12">
          <h2 className="text-2xl font-bold mb-8">{t('dashboard')}</h2>
          <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-12" data-aos="fade-up">
            <div className="bg-white dark:bg-gray-700 p-6 rounded-lg shadow">
              <p>{t('total_invoices')}: 10</p>
            </div>
            <div className="bg-white dark:bg-gray-700 p-6 rounded-lg shadow">
              <p>{t('total_paid')}: 25,000</p>
            </div>
            <div className="bg-white dark:bg-gray-700 p-6 rounded-lg shadow">
              <p>{t('overdue')}: 2</p>
            </div>
            <div className="bg-white dark:bg-gray-700 p-6 rounded-lg shadow">
              <p>{t('total_clients')}: 5</p>
            </div>
          </div>
          <canvas id="revenueChart" className="mb-12"></canvas>
          <div className="bg-white dark:bg-gray-700 p-6 rounded-lg shadow">
            <h3 className="text-xl font-bold mb-4">{t('invoices')}</h3>
            <table className="w-full">
              <thead>
                <tr>
                  <th>{t('invoice_number')}</th>
                  <th>{t('client_name')}</th>
                  <th>{t('due_date')}</th>
                  <th>{t('amount')}</th>
                  <th>{t('status')}</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                {mockInvoices.map(invoice => (
                  <tr key={invoice.id}>
                    <td>{invoice.id}</td>
                    <td>{invoice.client.name}</td>
                    <td>{invoice.dueDate}</td>
                    <td>{invoice.total}</td>
                    <td>{t(invoice.status.toLowerCase())}</td>
                    <td>
                      <Link to={`/invoices/${invoice.id}`} className="text-blue-600">{t('view')}</Link>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
            <Link to="/invoices/new" className="mt-4 inline-block bg-blue-600 text-white px-4 py-2 rounded">{t('new_invoice')}</Link>
          </div>
        </div>
      );
    };

    const InvoiceForm = ({ invoice }) => {
      const { t } = useTranslation();
      const { register, handleSubmit, control, watch } = useForm({
        defaultValues: invoice || { items: [{ desc: '', qty: 1, unitPrice: 0 }], taxPercent: 14, discount: 0 }
      });
      const [items, setItems] = useState(invoice?.items || [{ desc: '', qty: 1, unitPrice: 0 }]);
      const navigate = useNavigate();

      const onSubmit = (data) => {
        alert('تم حفظ الفاتورة');
        navigate('/invoices');
      };

      const addItem = () => setItems([...items, { desc: '', qty: 1, unitPrice: 0 }]);
      const removeItem = (index) => setItems(items.filter((_, i) => i !== index));

      const subtotal = items.reduce((sum, item) => sum + item.qty * item.unitPrice, 0);
      const tax = subtotal * (watch('taxPercent') / 100);
      const total = subtotal + tax - watch('discount');

      return (
        <div className="container mx-auto py-12">
          <h2 className="text-2xl font-bold mb-8">{t(invoice ? 'edit' : 'create_invoice')}</h2>
          <form onSubmit={handleSubmit(onSubmit)} className="max-w-lg mx-auto space-y-4">
            <input {...register('client.name')} placeholder={t('client_name')} className="w-full p-3 rounded-lg dark:bg-gray-700" required />
            <input {...register('issueDate')} type="date" className="w-full p-3 rounded-lg dark:bg-gray-700" required />
            <input {...register('dueDate')} type="date" className="w-full p-3 rounded-lg dark:bg-gray-700" required />
            {items.map((item, index) => (
              <div key={index} className="flex space-x-2 space-x-reverse">
                <input {...register(`items:${index}:desc`)} placeholder={t('item_desc')} className="flex-1 p-3 rounded-lg dark:bg-gray-700" required />
                <input {...register(`items:${index}:qty`)} type="number" placeholder={t('quantity')} className="w-20 p-3 rounded-lg dark:bg-gray-700" required />
                <input {...register(`items:${index}:unitPrice`)} type="number" placeholder={t('unit_price')} className="w-24 p-3 rounded-lg dark:bg-gray-700" required />
                <button type="button" onClick={() => removeItem(index)} className="bg-red-500 text-white p-3 rounded-lg">X</button>
              </div>
            ))}
            <button type="button" onClick={addItem} className="bg-blue-600 text-white px-4 py-2 rounded">{t('add_item')}</button>
            <input {...register('taxPercent')} type="number" placeholder={t('tax_rate')} className="w-full p-3 rounded-lg dark:bg-gray-700" />
            <input {...register('discount')} type="number" placeholder={t('discount')} className="w-full p-3 rounded-lg dark:bg-gray-700" />
            <div>
              <p>{t('subtotal')}: {subtotal}</p>
              <p>{t('tax')}: {tax}</p>
              <p>{t('total')}: {total}</p>
            </div>
            <button type="submit" className="bg-green-500 text-white px-6 py-3 rounded-lg">{t('save')}</button>
          </form>
        </div>
      );
    };

    const InvoiceDetail = () => {
      const { t } = useTranslation();
      const { id } = ReactRouterDOM.useParams();
      const invoice = mockInvoices.find(inv => inv.id === id);

      const downloadPDF = () => {
        const element = document.getElementById('invoice');
        html2canvas(element).then(canvas => {
          const imgData = canvas.toDataURL('image/png');
          const { jsPDF } = window.jspdf;
          const pdf = new jsPDF();
          pdf.addImage(imgData, 'PNG', 10, 10);
          pdf.save(`${invoice.id}.pdf`);
        });
      };

      if (!invoice) return <div>Invoice not found</div>;

      return (
        <div className="container mx-auto py-12">
          <div id="invoice" className="bg-white dark:bg-gray-700 p-6 rounded-lg shadow">
            <h2 className="text-2xl font-bold mb-4">{t('invoice_number')}: {invoice.id}</h2>
            <p>{t('client_name')}: {invoice.client.name}</p>
            <p>{t('issue_date')}: {invoice.issueDate}</p>
            <p>{t('due_date')}: {invoice.dueDate}</p>
            <table className="w-full mt-4">
              <thead>
                <tr>
                  <th>{t('item_desc')}</th>
                  <th>{t('quantity')}</th>
                  <th>{t('unit_price')}</th>
                  <th>{t('total')}</th>
                </tr>
              </thead>
              <tbody>
                {invoice.items.map((item, index) => (
                  <tr key={index}>
                    <td>{item.desc}</td>
                    <td>{item.qty}</td>
                    <td>{item.unitPrice}</td>
                    <td>{item.qty * item.unitPrice}</td>
                  </tr>
                ))}
              </tbody>
            </table>
            <div className="mt-4">
              <p>{t('subtotal')}: {invoice.subtotal}</p>
              <p>{t('tax')}: {invoice.tax}</p>
              <p>{t('total')}: {invoice.total}</p>
            </div>
            <div className="mt-4 space-x-2 space-x-reverse">
              <button onClick={downloadPDF} className="bg-blue-600 text-white px-4 py-2 rounded">{t('print')}</button>
              <a href={`mailto:${invoice.client.email}?subject=Invoice ${invoice.id}`} className="bg-green-500 text-white px-4 py-2 rounded">{t('send_email')}</a>
              <Link to={`/invoices/edit/${invoice.id}`} className="bg-yellow-500 text-white px-4 py-2 rounded">{t('edit')}</Link>
            </div>
          </div>
        </div>
      );
    };

    const InvoicesList = () => {
      const { t } = useTranslation();
      return (
        <div className="container mx-auto py-12">
          <h2 className="text-2xl font-bold mb-8">{t('invoices')}</h2>
          <table className="w-full bg-white dark:bg-gray-700 rounded-lg shadow">
            <thead>
              <tr>
                <th>{t('invoice_number')}</th>
                <th>{t('client_name')}</th>
                <th>{t('due_date')}</th>
                <th>{t('amount')}</th>
                <th>{t('status')}</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              {mockInvoices.map(invoice => (
                <tr key={invoice.id}>
                  <td>{invoice.id}</td>
                  <td>{invoice.client.name}</td>
                  <td>{invoice.dueDate}</td>
                  <td>{invoice.total}</td>
                  <td>{t(invoice.status.toLowerCase())}</td>
                  <td>
                    <Link to={`/invoices/${invoice.id}`} className="text-blue-600">{t('view')}</Link>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      );
    };

    const Clients = () => {
      const { t } = useTranslation();
      return (
        <div className="container mx-auto py-12">
          <h2 className="text-2xl font-bold mb-8">{t('clients')}</h2>
          <table className="w-full bg-white dark:bg-gray-700 rounded-lg shadow">
            <thead>
              <tr>
                <th>{t('company_name')}</th>
                <th>{t('contact')}</th>
                <th>{t('email')}</th>
                <th>{t('phone')}</th>
              </tr>
            </thead>
            <tbody>
              {mockClients.map(client => (
                <tr key={client.id}>
                  <td>{client.company}</td>
                  <td>{client.contact}</td>
                  <td>{client.email}</td>
                  <td>{client.phone}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      );
    };

    const Settings = () => {
      const { t } = useTranslation();
      return (
        <div className="container mx-auto py-12">
          <h2 className="text-2xl font-bold mb-8">{t('settings')}</h2>
          <div className="bg-white dark:bg-gray-700 p-6 rounded-lg shadow">
            <label className="block mb-4">
              {t('company_name')}
              <input type="text" className="w-full p-3 rounded-lg dark:bg-gray-700 mt-2" defaultValue="EasyInvoice" />
            </label>
            <label className="block mb-4">
              {t('currency')}
              <input type="text" className="w-full p-3 rounded-lg dark:bg-gray-700 mt-2" defaultValue="EGP" />
            </label>
            <label className="block mb-4">
              {t('tax_rate')}
              <input type="number" className="w-full p-3 rounded-lg dark:bg-gray-700 mt-2" defaultValue="14" />
            </label>
          </div>
        </div>
      );
    };

    const App = () => {
      useEffect(() => {
        AOS.init({ duration: 1000 });
      }, []);

      return (
        <BrowserRouter>
          <Header />
          <Routes>
            <Route path="/" element={<LandingPage />} />
            <Route path="/dashboard" element={<Dashboard />} />
            <Route path="/invoices" element={<InvoicesList />} />
            <Route path="/invoices/:id" element={<InvoiceDetail />} />
            <Route path="/invoices/new" element={<InvoiceForm />} />
            <Route path="/invoices/edit/:id" element={<InvoiceForm invoice={mockInvoices[0]} />} />
            <Route path="/clients" element={<Clients />} />
            <Route path="/settings" element={<Settings />} />
            <Route path="/privacy" element={<div className="container mx-auto py-12"><h2>{t('privacy_policy')}</h2><p>سياسة الخصوصية هنا...</p></div>} />
            <Route path="/terms" element={<div className="container mx-auto py-12"><h2>{t('terms')}</h2><p>الشروط والأحكام هنا...</p></div>} />
            <Route path="/contact" element={<div className="container mx-auto py-12"><h2>{t('contact')}</h2><p>تواصلوا معنا عبر البريد...</p></div>} />
          </Routes>
          <Footer />
        </BrowserRouter>
      );
    };

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>